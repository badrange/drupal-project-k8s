
# Values in this file override the default values of our helm chart.
#
# See https://github.com/wunderio/charts/blob/master/drupal/values.yaml
# for all possible options.

varnish:
  enabled: false

elasticsearch:
  enabled: true

memcached:
  enabled: false

mounts:
  private-files:
    enabled: true


mariadb:
  enabled: true
  replication:
    enabled: false
  db:
    name: drupal
    user: drupal

  master:
    config: |-
        [mysqld]
        skip-name-resolve
        explicit_defaults_for_timestamp
        basedir=/opt/bitnami/mariadb
        plugin_dir=/opt/bitnami/mariadb/plugin
        port=3306
        socket=/opt/bitnami/mariadb/tmp/mysql.sock
        tmpdir=/opt/bitnami/mariadb/tmp
        max_allowed_packet=256M
        bind-address=0.0.0.0
        pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
        log-error=/opt/bitnami/mariadb/logs/mysqld.log
        character-set-server=UTF8
        collation-server=utf8_unicode_ci
        transaction-isolation=READ-COMMITTED
        #set innodb_buffer_pool_size to 70/80% of the memory request
        innodb_buffer_pool_size=384M
        #set this to 1 per gigabyte of memory allocated in innodb_buffer_pool_size
        innodb_buffer_pool_instances=1
        innodb_log_buffer_size=8M
        #normally should be 25% of innodb buffer size with 2 files of 12.5% each.
        #here 48M is 12.5% OF 384M
        innodb_log_file_size=48M
        innodb_lock_wait_timeout=120
        innodb_open_files=49152
        innodb_flush_log_at_trx_commit=2
        innodb_thread_concurrency=16
        innodb_flush_method=O_DIRECT
        table_open_cache=4000
        table_definition_cache=1000
        back_log=2048
        tmp_table_size=64M
        max_heap_table_size=32M
        join_buffer_size=2M
        #have_query_cache=NO
        performance_schema=1
        innodb_write_io_threads=16
        #Silta seems to require this variable set to 0
        #https://mariadb.com/kb/en/innodb-system-variables/#innodb_use_native_aio
        innodb_use_native_aio=0
        [client]
        port=3306
        socket=/opt/bitnami/mariadb/tmp/mysql.sock
        default-character-set=UTF8
        plugin_dir=/opt/bitnami/mariadb/plugin
        [manager]
        port=3306
        socket=/opt/bitnami/mariadb/tmp/mysql.sock
        pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
    persistence:
      # Database storage disk space allocation
      # Request assistance from ops team after changing this on existing deployment.
      size: 1G
    resources:
      requests:
        cpu: 25m
        memory: 384M
      limits:
        memory: 512M
    affinity:
      nodeAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
            - key: cloud.google.com/gke-nodepool
              operator: NotIn
              values:
              - static-ip

# Configuration for everything that runs in shell container.
shell:
    resources:
      requests:
        cpu: 25m
        memory: 384M
      limits:
        cpu: 2000m
        memory: 1024M




# Allow access from another namespace for testing purposes.
silta-release:
  proxy:
    enabled: true
    no_proxy: ".example.com"
  ingressAccess:
    test:
      additionalPodSelector:
        app: drupal
      from:
        - namespaceSelector:
            matchLabels:
              name: drupal-project
    allowESaccess:
      additionalPodSelector:
        chart: elasticsearch
      from:
        - namespaceSelector:
            matchLabels:
              name: drupal-project
